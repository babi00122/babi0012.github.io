<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>PackCat ğŸ± - æ—…è¡Œæ‰“åŒ…åŠ©æ‰‹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ff9eb5;
            --secondary-color: #b5a6ff;
            --accent-color: #ffb5a7;
            --light-color: #fff5f7;
            --text-color: #5a5a5a;
            --success-color: #8dd7a1;
            --cat-paw-color: #ffd1dc;
            --border-radius: 16px;
            --card-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            --mobile-padding: 15px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fff9fb;
            color: var(--text-color);
            line-height: 1.5;
            padding: var(--mobile-padding);
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
        }
        
        /* éŸ¿æ‡‰å¼å­—é«”å¤§å° */
        @media (min-width: 768px) {
            body {
                padding: 25px;
            }
        }
        
        /* æ¨™é¡Œå€åŸŸ */
        header {
            text-align: center;
            padding: 20px 15px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(255, 158, 181, 0.15);
            margin-bottom: 20px;
            border: 2px dashed var(--primary-color);
            position: relative;
        }
        
        @media (min-width: 768px) {
            header {
                padding: 30px 25px;
                margin-bottom: 30px;
            }
        }
        
        h1 {
            font-family: 'Ma Shan Zheng', cursive;
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        @media (min-width: 768px) {
            h1 {
                font-size: 2.5rem;
                gap: 15px;
            }
        }
        
        .subtitle {
            color: var(--secondary-color);
            font-size: 1rem;
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        @media (min-width: 768px) {
            .subtitle {
                font-size: 1.2rem;
                margin-bottom: 20px;
            }
        }
        
        /* è¡Œç¨‹è³‡è¨Šç¶²æ ¼ - éŸ¿æ‡‰å¼ */
        .trip-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            background-color: var(--light-color);
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px auto 0;
            border: 1px solid rgba(255, 158, 181, 0.3);
        }
        
        @media (min-width: 480px) {
            .trip-info-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (min-width: 768px) {
            .trip-info-grid {
                gap: 20px;
                padding: 20px;
                margin: 20px auto 0;
                max-width: 900px;
            }
        }
        
        .info-card {
            background-color: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border: 1px solid transparent;
            text-align: center;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        @media (min-width: 768px) {
            .info-card {
                padding: 20px;
                border-radius: 15px;
            }
        }
        
        .info-card.editing {
            border-color: var(--secondary-color);
            background-color: #f9f5ff;
        }
        
        .info-label {
            font-size: 0.8rem;
            color: var(--text-color);
            opacity: 0.8;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        @media (min-width: 768px) {
            .info-label {
                font-size: 0.9rem;
                margin-bottom: 10px;
            }
        }
        
        .edit-icon {
            color: var(--secondary-color);
            cursor: pointer;
            font-size: 0.8rem;
            padding: 3px;
            border-radius: 50%;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }
        
        .edit-icon:hover {
            background-color: rgba(181, 166, 255, 0.2);
            transform: scale(1.1);
        }
        
        .info-value {
            font-weight: bold;
            color: var(--secondary-color);
            font-size: 1rem;
            min-height: 30px;
            word-break: break-word;
        }
        
        @media (min-width: 768px) {
            .info-value {
                font-size: 1.2rem;
            }
        }
        
        .info-input {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            font-family: 'Noto Sans TC', sans-serif;
            font-size: 1rem;
            font-weight: bold;
            color: var(--secondary-color);
            background-color: white;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .info-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 158, 181, 0.3);
            border-color: var(--accent-color);
        }
        
        /* é€²åº¦æ¢å€åŸŸ */
        .progress-container {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(255, 158, 181, 0.2);
        }
        
        @media (min-width: 768px) {
            .progress-container {
                padding: 25px;
                margin-bottom: 30px;
            }
        }
        
        .progress-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .progress-title {
            font-size: 1.1rem;
            color: var(--primary-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        @media (min-width: 768px) {
            .progress-title {
                font-size: 1.3rem;
                gap: 10px;
            }
        }
        
        .progress-bar {
            height: 20px;
            background-color: #f5f5f5;
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
            border: 1px solid #f0f0f0;
            position: relative;
        }
        
        @media (min-width: 768px) {
            .progress-bar {
                height: 25px;
            }
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
            width: 0%;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        /* æ¸…å–®å®¹å™¨ - éŸ¿æ‡‰å¼ç¶²æ ¼ */
        .checklist-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        @media (min-width: 768px) {
            .checklist-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 25px;
            }
        }
        
        @media (min-width: 1024px) {
            .checklist-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 30px;
            }
        }
        
        /* åˆ†é¡å¡ç‰‡ */
        .category-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
            cursor: move;
            touch-action: manipulation;
            -webkit-user-drag: element;
        }
        
        .category-card.dragging {
            opacity: 0.7;
            transform: rotate(2deg);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(255, 158, 181, 0.2);
            border-color: var(--primary-color);
        }
        
        @media (min-width: 768px) {
            .category-card {
                padding: 25px;
            }
        }
        
        .category-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px dotted var(--light-color);
        }
        
        .category-icon {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-right: 15px;
            width: 50px;
            height: 50px;
            background-color: var(--light-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        @media (min-width: 768px) {
            .category-icon {
                width: 60px;
                height: 60px;
                font-size: 1.8rem;
            }
        }
        
        .category-title {
            font-size: 1.2rem;
            color: var(--secondary-color);
            font-weight: 700;
            flex-grow: 1;
            word-break: break-word;
        }
        
        @media (min-width: 768px) {
            .category-title {
                font-size: 1.4rem;
            }
        }
        
        .category-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .category-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 34px;
            height: 34px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        @media (min-width: 768px) {
            .category-btn {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
        }
        
        .category-btn:hover {
            transform: scale(1.1);
        }
        
        .edit-category-btn {
            background-color: var(--secondary-color);
        }
        
        .delete-category-btn {
            background-color: #ff6b6b;
        }
        
        /* ç‰©å“åˆ—è¡¨ */
        .items-list {
            list-style-type: none;
        }
        
        .item {
            display: flex;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px dashed #f0f0f0;
            transition: all 0.3s ease;
            cursor: move;
            touch-action: manipulation;
            position: relative;
        }
        
        .item.dragging {
            opacity: 0.7;
            background-color: rgba(255, 158, 181, 0.1);
            border-radius: 10px;
        }
        
        .item:last-child {
            border-bottom: none;
        }
        
        .drag-handle {
            color: #ddd;
            margin-right: 10px;
            cursor: move;
            font-size: 1.2rem;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .drag-handle:hover {
            color: var(--primary-color);
        }
        
        .checkbox {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            cursor: pointer;
            accent-color: var(--primary-color);
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        @media (min-width: 768px) {
            .checkbox {
                width: 28px;
                height: 28px;
                margin-right: 15px;
            }
        }
        
        .item-content {
            flex-grow: 1;
            min-width: 0; /* é˜²æ­¢å…§å®¹æº¢å‡º */
        }
        
        .item-label {
            font-size: 1rem;
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            word-break: break-word;
        }
        
        @media (min-width: 768px) {
            .item-label {
                font-size: 1.05rem;
            }
        }
        
        .item-quantity {
            display: inline-block;
            background-color: var(--light-color);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            color: var(--secondary-color);
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 8px;
            border: 1px solid rgba(255, 158, 181, 0.3);
        }
        
        .item-note {
            font-size: 0.85rem;
            color: #888;
            font-style: italic;
            display: block;
            line-height: 1.4;
            word-break: break-word;
        }
        
        .item-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
            margin-left: 10px;
        }
        
        .item-btn {
            background: none;
            border: none;
            color: #bbb;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            padding: 5px;
            border-radius: 6px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @media (min-width: 768px) {
            .item-btn {
                width: 34px;
                height: 34px;
            }
        }
        
        .item-btn:hover {
            color: var(--primary-color);
            background-color: rgba(255, 158, 181, 0.15);
        }
        
        .edit-btn:hover {
            color: var(--secondary-color);
            background-color: rgba(181, 166, 255, 0.15);
        }
        
        .delete-btn:hover {
            color: #ff6b6b;
            background-color: rgba(255, 107, 107, 0.1);
        }
        
        /* æ§åˆ¶æŒ‰éˆ•å€åŸŸ */
        .controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 30px;
        }
        
        @media (min-width: 480px) {
            .controls {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (min-width: 768px) {
            .controls {
                display: flex;
                justify-content: center;
                gap: 20px;
                margin-top: 40px;
                flex-wrap: wrap;
            }
        }
        
        button {
            padding: 14px 12px;
            border: none;
            border-radius: 50px;
            font-family: 'Noto Sans TC', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 0;
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        @media (min-width: 768px) {
            button {
                padding: 16px 20px;
                font-size: 1rem;
                gap: 10px;
                min-width: 180px;
            }
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #ff7b9d;
            transform: translateY(-3px);
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #9485ff;
            transform: translateY(-3px);
        }
        
        .btn-accent {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-accent:hover {
            background-color: #ff9b8a;
            transform: translateY(-3px);
        }
        
        .btn-reset {
            background-color: #f0f0f0;
            color: var(--text-color);
        }
        
        .btn-reset:hover {
            background-color: #e0e0e0;
            transform: translateY(-3px);
        }
        
        .btn-restore {
            background-color: #ffd166;
            color: #5a5a5a;
        }
        
        .btn-restore:hover {
            background-color: #ffc043;
            transform: translateY(-3px);
        }
        
        /* å®Œæˆç‹€æ…‹ */
        .completed .item-label {
            text-decoration: line-through;
            color: #bbb;
        }
        
        .completed .item-quantity {
            opacity: 0.6;
            background-color: #f5f5f5;
        }
        
        /* å°è²¼å£«å€åŸŸ */
        .cat-tip {
            background-color: #fff8e1;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 30px;
            border-left: 5px solid var(--accent-color);
            position: relative;
        }
        
        @media (min-width: 768px) {
            .cat-tip {
                padding: 25px;
                margin-top: 40px;
            }
        }
        
        .tip-content h3 {
            color: var(--accent-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }
        
        .edit-tip-btn {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 5px 10px;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }
        
        .edit-tip-btn:hover {
            background-color: rgba(255, 181, 167, 0.15);
        }
        
        /* æ–°å¢åˆ†é¡æŒ‰éˆ• */
        .add-category-btn {
            width: 100%;
            padding: 20px;
            background-color: white;
            border: 3px dashed var(--primary-color);
            border-radius: var(--border-radius);
            color: var(--primary-color);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        @media (min-width: 768px) {
            .add-category-btn {
                padding: 25px;
                font-size: 1.3rem;
                margin-bottom: 30px;
            }
        }
        
        .add-category-btn:hover {
            background-color: var(--light-color);
            transform: translateY(-3px);
        }
        
        /* å½ˆå‡ºè¦–çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: var(--mobile-padding);
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            border: 3px solid var(--primary-color);
            animation: modalAppear 0.3s ease-out;
        }
        
        @keyframes modalAppear {
            0% { opacity: 0; transform: translateY(30px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .modal-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-color);
            font-weight: 500;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            font-family: 'Noto Sans TC', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: #f9f9f9;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: white;
            box-shadow: 0 0 0 2px rgba(255, 158, 181, 0.2);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            min-width: 80px;
        }
        
        .modal-btn-cancel {
            background-color: #f0f0f0;
            color: var(--text-color);
        }
        
        .modal-btn-save {
            background-color: var(--primary-color);
            color: white;
        }
        
        .modal-btn-cancel:hover {
            background-color: #e0e0e0;
        }
        
        .modal-btn-save:hover {
            background-color: #ff7b9d;
        }
        
        /* åœ–ç¤ºé¸æ“‡å™¨ */
        .icon-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        @media (min-width: 480px) {
            .icon-selector {
                grid-template-columns: repeat(5, 1fr);
            }
        }
        
        .icon-option {
            text-align: center;
            padding: 12px 5px;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .icon-option:hover {
            border-color: var(--primary-color);
            background-color: var(--light-color);
        }
        
        .icon-option.selected {
            border-color: var(--primary-color);
            background-color: var(--light-color);
            transform: scale(1.05);
        }
        
        .icon-option i {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        /* æœªæº–å‚™ç‰©å“åˆ—è¡¨ */
        .unpacked-items-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .unpacked-category {
            margin-bottom: 20px;
            background-color: #fff9fb;
            border-radius: 15px;
            padding: 15px;
            border: 1px solid #ffecf0;
        }
        
        .unpacked-category-title {
            color: var(--secondary-color);
            font-size: 1.1rem;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #ffd1dc;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .unpacked-item {
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            margin-bottom: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .empty-state {
            text-align: center;
            padding: 30px 20px;
            color: #aaa;
            font-size: 1.1rem;
        }
        
        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--cat-paw-color);
        }
        
        /* é å°¾ */
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #aaa;
            font-size: 0.9rem;
            border-top: 1px dashed #f0f0f0;
        }
        
        @media (min-width: 768px) {
            footer {
                margin-top: 60px;
                padding: 25px;
            }
        }
        
        /* æ‹–æ”¾æŒ‡ç¤ºå™¨ */
        .drop-indicator {
            height: 4px;
            background-color: var(--primary-color);
            margin: 5px 0;
            border-radius: 2px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .drop-indicator.active {
            opacity: 1;
        }
        
        /* ç§»å‹•è¨­å‚™å„ªåŒ– */
        @media (max-width: 767px) {
            /* åœ¨å°å±å¹•ä¸Šèª¿æ•´æŒ‰éˆ•å…§æ–‡å­— */
            button span:not(.fa) {
                display: none;
            }
            
            button .fa {
                margin-right: 0;
                font-size: 1.2rem;
            }
            
            /* èª¿æ•´æ§åˆ¶æŒ‰éˆ• */
            .controls {
                gap: 8px;
            }
            
            /* åˆ†é¡æ“ä½œæŒ‰éˆ•å †ç–Š */
            .category-actions {
                flex-direction: column;
            }
            
            /* ç‰©å“æ“ä½œæŒ‰éˆ•å †ç–Š */
            .item-actions {
                flex-direction: column;
                gap: 5px;
            }
            
            /* èª¿æ•´å½ˆå‡ºè¦–çª—å…§æŒ‰éˆ• */
            .modal-actions {
                flex-direction: column;
            }
            
            .modal-btn {
                width: 100%;
            }
        }
        
        /* å¹³æ¿å„ªåŒ– */
        @media (min-width: 768px) and (max-width: 1023px) {
            .checklist-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fas fa-paw"></i> PackCat <i class="fas fa-paw"></i></h1>
        <div class="subtitle" id="tripTitle" contenteditable="true">æ—…è¡Œæ‰“åŒ…åŠ©æ‰‹</div>
        
        <!-- è¡Œç¨‹è³‡è¨Šç¶²æ ¼ -->
        <div class="trip-info-grid">
            <div class="info-card" id="destinationCard">
                <div class="info-label">
                    <span>ç›®çš„åœ°</span>
                    <i class="fas fa-edit edit-icon" data-field="destination"></i>
                </div>
                <div class="info-value" id="destinationValue">åå¤å±‹, æ—¥æœ¬</div>
                <input type="text" class="info-input" id="destinationInput" style="display: none;" value="åå¤å±‹, æ—¥æœ¬">
            </div>
            
            <div class="info-card" id="monthCard">
                <div class="info-label">
                    <span>æ—…è¡Œæœˆä»½</span>
                    <i class="fas fa-edit edit-icon" data-field="month"></i>
                </div>
                <div class="info-value" id="monthValue">12æœˆ (å†¬å­£)</div>
                <input type="text" class="info-input" id="monthInput" style="display: none;" value="12æœˆ (å†¬å­£)">
            </div>
            
            <div class="info-card" id="daysCard">
                <div class="info-label">
                    <span>æ—…è¡Œå¤©æ•¸</span>
                    <i class="fas fa-edit edit-icon" data-field="days"></i>
                </div>
                <div class="info-value" id="daysValue">10å¤©</div>
                <input type="number" min="1" max="30" class="info-input" id="daysInput" style="display: none;" value="10">
            </div>
            
            <div class="info-card" id="peopleCard">
                <div class="info-label">
                    <span>é©ç”¨è€…</span>
                    <i class="fas fa-edit edit-icon" data-field="people"></i>
                </div>
                <div class="info-value" id="peopleValue">å¯æ„›çš„äºº</div>
                <input type="text" class="info-input" id="peopleInput" style="display: none;" value="å¯æ„›çš„äºº">
            </div>
        </div>
    </header>
    
    <!-- æ–°å¢åˆ†é¡æŒ‰éˆ• -->
    <button class="add-category-btn" id="addCategoryBtn">
        <i class="fas fa-plus-circle"></i> <span>æ–°å¢åˆ†é¡</span>
    </button>
    
    <!-- é€²åº¦æ¢ -->
    <div class="progress-container">
        <div class="progress-header">
            <div class="progress-title">
                <i class="fas fa-tasks"></i> <span>æ‰“åŒ…é€²åº¦</span>
            </div>
            <div id="progressPercent">0%</div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text">
            <span>å·²æ‰“åŒ…: <span id="packedCount">0</span> é …</span>
            <span>ç¸½è¨ˆ: <span id="totalCount">0</span> é …</span>
        </div>
    </div>
    
    <!-- æ‰“åŒ…æ¸…å–® -->
    <div class="checklist-container" id="checklist">
        <!-- æ¸…å–®å…§å®¹å°‡é€šéJavaScriptå‹•æ…‹ç”Ÿæˆ -->
    </div>
    
    <!-- å¯ç·¨è¼¯çš„å°è²¼å£« -->
    <div class="cat-tip">
        <div class="tip-content">
            <h3>å°è²¼å£« ğŸ’¡ <button class="edit-tip-btn" id="editTipBtn"><i class="fas fa-edit"></i> <span>ç·¨è¼¯</span></button></h3>
            <p id="tipContent">è¡£ç‰©æ•¸é‡å·²æ ¹æ“šæ‚¨çš„æ—…è¡Œå¤©æ•¸è‡ªå‹•è¨ˆç®—ã€‚æ‚¨å¯ä»¥æ‹–å‹•ç‰©å“å’Œåˆ†é¡ä¾†èª¿æ•´é †åºï¼Œé»æ“Šç‰©å“å‰çš„æ–¹æ¡†æ¨™è¨˜ç‚ºå·²æ‰“åŒ…ã€‚</p>
        </div>
    </div>
    
    <!-- æ§åˆ¶æŒ‰éˆ• -->
    <div class="controls">
        <button class="btn-primary" id="saveBtn">
            <i class="fas fa-save"></i> <span>å„²å­˜é€²åº¦</span>
        </button>
        <button class="btn-accent" id="showUnpackedBtn">
            <i class="fas fa-search"></i> <span>æœªæº–å‚™ç‰©å“</span>
        </button>
        <button class="btn-secondary" id="checkAllBtn">
            <i class="fas fa-check-double"></i> <span>å…¨é¸/å–æ¶ˆ</span>
        </button>
        <button class="btn-reset" id="resetBtn">
            <i class="fas fa-redo"></i> <span>é‡ç½®å‹¾é¸</span>
        </button>
        <button class="btn-restore" id="restoreBtn">
            <i class="fas fa-history"></i> <span>æ¢å¾©é è¨­</span>
        </button>
    </div>
    
    <!-- ç‰©å“å½ˆå‡ºè¦–çª— -->
    <div class="modal" id="itemModal">
        <div class="modal-content">
            <h2 class="modal-title" id="modalTitle">æ–°å¢ç‰©å“</h2>
            <div class="form-group">
                <label for="itemName">ç‰©å“åç¨±</label>
                <input type="text" id="itemName" placeholder="ä¾‹å¦‚ï¼šå…§è¡£">
            </div>
            <div class="form-group">
                <label for="itemQuantity">å»ºè­°æ•¸é‡ï¼ˆåƒ…æ•¸å­—ï¼‰</label>
                <input type="text" id="itemQuantity" placeholder="ä¾‹å¦‚ï¼š10-11">
            </div>
            <div class="form-group">
                <label for="itemNote">å‚™è¨»</label>
                <textarea id="itemNote" placeholder="ä¾‹å¦‚ï¼šæ¯å¤©ä¸€ä»¶+å‚™ç”¨"></textarea>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" id="cancelItemBtn">å–æ¶ˆ</button>
                <button class="modal-btn modal-btn-save" id="saveItemBtn">å„²å­˜</button>
            </div>
        </div>
    </div>
    
    <!-- åˆ†é¡å½ˆå‡ºè¦–çª— -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <h2 class="modal-title" id="categoryModalTitle">æ–°å¢åˆ†é¡</h2>
            <div class="form-group">
                <label for="categoryName">åˆ†é¡åç¨±</label>
                <input type="text" id="categoryName" placeholder="ä¾‹å¦‚ï¼šæ´—æ¼±ç”¨å“">
            </div>
            <div class="form-group">
                <label>é¸æ“‡åœ–ç¤º</label>
                <div class="icon-selector" id="iconSelector">
                    <!-- åœ–ç¤ºé¸é …å°‡ç”±JavaScriptç”Ÿæˆ -->
                </div>
                <input type="hidden" id="selectedIcon" value="fas fa-star">
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" id="cancelCategoryBtn">å–æ¶ˆ</button>
                <button class="modal-btn modal-btn-save" id="saveCategoryBtn">å„²å­˜</button>
            </div>
        </div>
    </div>
    
    <!-- å°è²¼å£«ç·¨è¼¯å½ˆå‡ºè¦–çª— -->
    <div class="modal" id="tipModal">
        <div class="modal-content">
            <h2 class="modal-title">ç·¨è¼¯å°è²¼å£«</h2>
            <div class="form-group">
                <label for="tipText">å°è²¼å£«å…§å®¹</label>
                <textarea id="tipText" rows="5">è¡£ç‰©æ•¸é‡å·²æ ¹æ“šæ‚¨çš„æ—…è¡Œå¤©æ•¸è‡ªå‹•è¨ˆç®—ã€‚æ‚¨å¯ä»¥æ‹–å‹•ç‰©å“å’Œåˆ†é¡ä¾†èª¿æ•´é †åºï¼Œé»æ“Šç‰©å“å‰çš„æ–¹æ¡†æ¨™è¨˜ç‚ºå·²æ‰“åŒ…ã€‚</textarea>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" id="cancelTipBtn">å–æ¶ˆ</button>
                <button class="modal-btn modal-btn-save" id="saveTipBtn">å„²å­˜</button>
            </div>
        </div>
    </div>
    
    <!-- æœªæº–å‚™ç‰©å“å½ˆå‡ºè¦–çª— -->
    <div class="modal" id="unpackedModal">
        <div class="modal-content">
            <h2 class="modal-title"><i class="fas fa-search"></i> æœªæº–å‚™ç‰©å“</h2>
            <div id="unpackedItemsContainer">
                <!-- æœªæº–å‚™ç‰©å“å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-save" id="closeUnpackedBtn">é—œé–‰</button>
            </div>
        </div>
    </div>
    
    <footer>
        <p>PackCat ğŸ± - å°ˆç‚ºå¯æ„›çš„äººè¨­è¨ˆçš„æ—…è¡Œæ‰“åŒ…åŠ©æ‰‹</p>
        <p>æç¤º: æ‰€æœ‰æ›´æ”¹éƒ½æœƒè‡ªå‹•å„²å­˜åœ¨æ‚¨çš„ç€è¦½å™¨ä¸­</p>
    </footer>

    <script>
        // å¯ç”¨åœ–ç¤ºæ¸…å–®
        const availableIcons = [
            "fas fa-passport", "fas fa-mobile-alt", "fas fa-tshirt", "fas fa-mitten",
            "fas fa-soap", "fas fa-first-aid", "fas fa-suitcase", "fas fa-shoe-prints",
            "fas fa-umbrella", "fas fa-sun", "fas fa-moon", "fas fa-star",
            "fas fa-heart", "fas fa-camera", "fas fa-headphones", "fas fa-book",
            "fas fa-gift", "fas fa-credit-card", "fas fa-wallet", "fas fa-key"
        ];
        
        // é è¨­æ¸…å–®æ•¸æ“š - åå¤å±‹å†¬å­£æ—…è¡Œ
        const defaultPackingList = [
            {
                id: Date.now() + 100,
                category: "ğŸ“„ è­‰ä»¶èˆ‡è²¡ç‰©",
                icon: "fas fa-passport",
                items: [
                    { id: Date.now() + 1, name: "è­·ç…§ (æœ‰æ•ˆæœŸè¶³å¤ )", quantity: "1", note: "ç¢ºä¿ç°½è­‰æœ‰æ•ˆ" },
                    { id: Date.now() + 2, name: "é¦™æ¸¯èº«ä»½è­‰", quantity: "1", note: "" },
                    { id: Date.now() + 3, name: "æ©Ÿç¥¨/ç™»æ©Ÿè­‰", quantity: "1", note: "æå‰ç¶²ä¸Šå ±åˆ°" },
                    { id: Date.now() + 4, name: "é…’åº—é è¨‚ç¢ºèªå–®", quantity: "1", note: "" },
                    { id: Date.now() + 5, name: "æ—¥åœ“ç¾é‡‘", quantity: "5-8è¬", note: "å»ºè­°åœ¨é¦™æ¸¯å…ˆå…Œæ›" },
                    { id: Date.now() + 6, name: "åœ‹éš›ä¿¡ç”¨å¡", quantity: "1-2", note: "Visa/Mastercard" },
                    { id: Date.now() + 7, name: "ä¿éšªå–®å½±æœ¬", quantity: "1", note: "æ—…éŠä¿éšª" }
                ]
            },
            {
                id: Date.now() + 200,
                category: "ğŸ“± é›»å­ç”¢å“",
                icon: "fas fa-mobile-alt",
                items: [
                    { id: Date.now() + 8, name: "æ‰‹æ©Ÿ & å……é›»å™¨", quantity: "1", note: "" },
                    { id: Date.now() + 9, name: "è¡Œå‹•é›»æº", quantity: "1", note: "â‰¤100Wh/27,000mAh" },
                    { id: Date.now() + 10, name: "æ—¥æœ¬è½‰æ›æ’é ­", quantity: "1-2", note: "é›™æ‰è…³æ’é ­" },
                    { id: Date.now() + 11, name: "å¤šå­”USBæ’æ’", quantity: "1", note: "æ–¹ä¾¿åŒæ™‚å……é›»" },
                    { id: Date.now() + 12, name: "ç›¸æ©Ÿ & å……é›»å™¨", quantity: "1", note: "æŒ‰éœ€è¦" },
                    { id: Date.now() + 13, name: "è€³æ©Ÿ", quantity: "1", note: "é£›æ©Ÿ/ç«è»Šä¸Šç”¨" },
                    { id: Date.now() + 14, name: "SIMå¡/ä¾¿æ”œWi-Fi", quantity: "1", note: "æå‰é è¨‚" }
                ]
            },
            {
                id: Date.now() + 300,
                category: "ğŸ‘š è¡£ç‰©é¡ (æ´‹è”¥å¼ç©¿æ­)",
                icon: "fas fa-tshirt",
                items: [
                    { id: Date.now() + 15, name: "å…§è¡£", quantity: "å‹•æ…‹è¨ˆç®—", note: "æ ¹æ“šæ—…è¡Œå¤©æ•¸è¨ˆç®—", baseFormula: "days+1" },
                    { id: Date.now() + 16, name: "å…§è¤²", quantity: "å‹•æ…‹è¨ˆç®—", note: "æ ¹æ“šæ—…è¡Œå¤©æ•¸è¨ˆç®—", baseFormula: "days+1" },
                    { id: Date.now() + 17, name: "è¥ªå­ (åšç¾Šæ¯›è¥ª)", quantity: "å‹•æ…‹è¨ˆç®—", note: "æ ¹æ“šæ—…è¡Œå¤©æ•¸è¨ˆç®—ï¼Œä¿æš–å¿…å‚™", baseFormula: "days+2" },
                    { id: Date.now() + 18, name: "ä¿æš–å…§è¡£/ç™¼ç†±è¡£", quantity: "å‹•æ…‹è¨ˆç®—", note: "å¯åœ¨ç•¶åœ°è²·Heattech", baseFormula: "2" },
                    { id: Date.now() + 19, name: "é•·è¢–ä¸Šè¡£", quantity: "å‹•æ…‹è¨ˆç®—", note: "ä¸­é–“å±¤æˆ–å®¤å…§ç©¿ï¼Œå¯é‡è¤‡ç©¿è‘—", baseFormula: "Math.ceil(days/2)" },
                    { id: Date.now() + 20, name: "æ¯›è¡£/æŠ“çµ¨è¡£", quantity: "å‹•æ…‹è¨ˆç®—", note: "ä¸­é–“ä¿æš–å±¤ï¼Œå¯é‡è¤‡ç©¿è‘—", baseFormula: "Math.ceil(days/3)" },
                    { id: Date.now() + 21, name: "é˜²é¢¨é˜²æ°´å¤–å¥—", quantity: "1", note: "æœ€å¤–å±¤é—œéµ" },
                    { id: Date.now() + 22, name: "é•·è¤²/ç‰›ä»”è¤²", quantity: "å‹•æ…‹è¨ˆç®—", note: "å¯é‡è¤‡ç©¿è‘—", baseFormula: "Math.ceil(days/4)" },
                    { id: Date.now() + 23, name: "ä¿æš–å±…å®¶æœ", quantity: "1", note: "é…’åº—æˆ¿é–“ç©¿" },
                    { id: Date.now() + 24, name: "ç¡è¡£", quantity: "å‹•æ…‹è¨ˆç®—", note: "", baseFormula: "1-2" }
                ]
            },
            {
                id: Date.now() + 400,
                category: "ğŸ§£ é…ä»¶èˆ‡é‹å±¥",
                icon: "fas fa-mitten",
                items: [
                    { id: Date.now() + 25, name: "åœå·¾", quantity: "1-2", note: "ä¿æš–å¿…å‚™" },
                    { id: Date.now() + 26, name: "å¸½å­/è€³ç½©", quantity: "1", note: "é˜²æ­¢é ­éƒ¨æ•£ç†±" },
                    { id: Date.now() + 27, name: "æ‰‹å¥—", quantity: "1", note: "è§¸æ§æ‰‹å¥—æ›´æ–¹ä¾¿" },
                    { id: Date.now() + 28, name: "é˜²æ°´é˜²æ»‘çŸ­é´", quantity: "1", note: "æ‡‰å°ä¹¾å†·å’Œå¶çˆ¾é›¨é›ª" },
                    { id: Date.now() + 29, name: "è¼•ä¾¿å®¤å…§æ‹–é‹", quantity: "1", note: "æ›´è¡›ç”Ÿ" },
                    { id: Date.now() + 30, name: "å‚™ç”¨ä¼‘é–’é‹", quantity: "1", note: "å¯é¸" },
                    { id: Date.now() + 31, name: "å¤ªé™½çœ¼é¡", quantity: "1", note: "å†¬å­£é™½å…‰ä¹Ÿå¯èƒ½åˆºçœ¼" }
                ]
            }
        ];

        // è¡Œç¨‹è³‡è¨Š
        let tripInfo = {
            destination: "åå¤å±‹, æ—¥æœ¬",
            month: "12æœˆ (å†¬å­£)",
            days: 10,
            people: "å¯æ„›çš„äºº",
            title: "æ—…è¡Œæ‰“åŒ…åŠ©æ‰‹"
        };
        
        // ç•¶å‰æ¸…å–®æ•¸æ“š
        let packingList = JSON.parse(JSON.stringify(defaultPackingList));
        
        // å°è²¼å£«å…§å®¹
        let tipContent = "è¡£ç‰©æ•¸é‡å·²æ ¹æ“šæ‚¨çš„æ—…è¡Œå¤©æ•¸è‡ªå‹•è¨ˆç®—ã€‚æ‚¨å¯ä»¥æ‹–å‹•ç‰©å“å’Œåˆ†é¡ä¾†èª¿æ•´é †åºï¼Œé»æ“Šç‰©å“å‰çš„æ–¹æ¡†æ¨™è¨˜ç‚ºå·²æ‰“åŒ…ã€‚";
        
        // æ‹–æ”¾ç›¸é—œè®Šæ•¸
        let draggedItem = null;
        let draggedCategory = null;
        let dragOverCategory = null;
        let dragOverItem = null;
        let isDragging = false;

        // è¨ˆç®—è¡£ç‰©æ•¸é‡ï¼ˆæ ¹æ“šå¤©æ•¸å’Œå…¬å¼ï¼‰
        function calculateClothingQuantity(baseFormula, days) {
            if (!baseFormula) return "";
            
            // è§£æå…¬å¼
            try {
                if (baseFormula === "days+1") {
                    return `${days + 1}`;
                } else if (baseFormula === "days+2") {
                    return `${days + 2}`;
                } else if (baseFormula === "2") {
                    return "2";
                } else if (baseFormula === "1-2") {
                    return "1-2";
                } else if (baseFormula.includes("Math.ceil(days/")) {
                    const divisor = parseInt(baseFormula.match(/Math\.ceil\(days\/(\d+)\)/)[1]);
                    return `${Math.ceil(days / divisor)}`;
                }
            } catch (e) {
                console.error("è¨ˆç®—è¡£ç‰©æ•¸é‡æ™‚å‡ºéŒ¯:", e);
            }
            
            return baseFormula;
        }

        // è¨ˆç®—ç¸½é …ç›®æ•¸
        function calculateTotalItems() {
            let totalItems = 0;
            packingList.forEach(category => {
                totalItems += category.items.length;
            });
            return totalItems;
        }

        // å¾æœ¬åœ°å„²å­˜è¼‰å…¥æ•¸æ“š
        let checkedItems = JSON.parse(localStorage.getItem('packcatCheckedItems')) || {};
        
        // å˜—è©¦å¾æœ¬åœ°å„²å­˜è¼‰å…¥è‡ªå®šç¾©æ¸…å–®
        const savedList = localStorage.getItem('packcatList');
        if (savedList) {
            packingList = JSON.parse(savedList);
        }
        
        // å˜—è©¦å¾æœ¬åœ°å„²å­˜è¼‰å…¥è¡Œç¨‹è³‡è¨Š
        const savedTripInfo = localStorage.getItem('packcatTripInfo');
        if (savedTripInfo) {
            tripInfo = JSON.parse(savedTripInfo);
        }
        
        // å˜—è©¦å¾æœ¬åœ°å„²å­˜è¼‰å…¥å°è²¼å£«
        const savedTip = localStorage.getItem('packcatTip');
        if (savedTip) {
            tipContent = savedTip;
        }

        // ç•¶å‰æ­£åœ¨ç·¨è¼¯çš„é …ç›®ä¿¡æ¯
        let currentEditItem = {
            categoryIndex: -1,
            itemIndex: -1,
            itemId: null,
            isEdit: false
        };
        
        // ç•¶å‰æ­£åœ¨ç·¨è¼¯çš„åˆ†é¡ä¿¡æ¯
        let currentEditCategory = {
            categoryIndex: -1,
            isEdit: false
        };
        
        // ç•¶å‰æ­£åœ¨ç·¨è¼¯çš„è¡Œç¨‹è³‡è¨Šå­—æ®µ
        let currentEditingField = null;

        // DOMå…ƒç´ 
        const itemModal = document.getElementById('itemModal');
        const categoryModal = document.getElementById('categoryModal');
        const tipModal = document.getElementById('tipModal');
        const unpackedModal = document.getElementById('unpackedModal');
        const itemNameInput = document.getElementById('itemName');
        const itemQuantityInput = document.getElementById('itemQuantity');
        const itemNoteInput = document.getElementById('itemNote');
        const categoryNameInput = document.getElementById('categoryName');
        const selectedIconInput = document.getElementById('selectedIcon');
        const tipTextInput = document.getElementById('tipText');
        const iconSelector = document.getElementById('iconSelector');
        const tipContentElement = document.getElementById('tipContent');
        const tripTitleElement = document.getElementById('tripTitle');
        const unpackedItemsContainer = document.getElementById('unpackedItemsContainer');

        // åˆå§‹åŒ–é é¢
        document.addEventListener('DOMContentLoaded', function() {
            // è¨­ç½®è¡Œç¨‹è³‡è¨Š
            updateTripInfoDisplay();
            
            // è¨­ç½®æ¨™é¡Œ
            tripTitleElement.textContent = tripInfo.title;
            
            // è¨­ç½®å°è²¼å£«å…§å®¹
            tipContentElement.textContent = tipContent;
            
            // ç”Ÿæˆåœ–ç¤ºé¸æ“‡å™¨
            renderIconSelector();
            
            // æ¸²æŸ“æ¸…å–®
            renderChecklist();
            updateProgress();
            
            // ç¶å®šè¡Œç¨‹è³‡è¨Šç·¨è¼¯äº‹ä»¶
            setupTripInfoEditing();
            
            // ç¶å®šæ¨™é¡Œç·¨è¼¯äº‹ä»¶
            tripTitleElement.addEventListener('blur', function() {
                tripInfo.title = this.textContent;
                localStorage.setItem('packcatTripInfo', JSON.stringify(tripInfo));
                document.title = `PackCat ğŸ± - ${tripInfo.title}`;
            });
            
            tripTitleElement.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    this.blur();
                }
            });
            
            // ç¶å®šå½ˆå‡ºè¦–çª—äº‹ä»¶
            document.getElementById('saveItemBtn').addEventListener('click', saveItem);
            document.getElementById('cancelItemBtn').addEventListener('click', closeItemModal);
            
            document.getElementById('saveCategoryBtn').addEventListener('click', saveCategory);
            document.getElementById('cancelCategoryBtn').addEventListener('click', closeCategoryModal);
            
            document.getElementById('saveTipBtn').addEventListener('click', saveTip);
            document.getElementById('cancelTipBtn').addEventListener('click', closeTipModal);
            
            document.getElementById('closeUnpackedBtn').addEventListener('click', function() {
                unpackedModal.style.display = 'none';
            });
            
            // é»æ“Šå½ˆå‡ºè¦–çª—èƒŒæ™¯é—œé–‰
            [itemModal, categoryModal, tipModal, unpackedModal].forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        if (this === itemModal) closeItemModal();
                        if (this === categoryModal) closeCategoryModal();
                        if (this === tipModal) closeTipModal();
                        if (this === unpackedModal) unpackedModal.style.display = 'none';
                    }
                });
            });
            
            // ç¶å®šæŒ‰éˆ•äº‹ä»¶
            document.getElementById('saveBtn').addEventListener('click', function() {
                saveProgress();
                showNotification('âœ… é€²åº¦å·²å„²å­˜ï¼');
            });
            
            // æŸ¥çœ‹æœªæº–å‚™ç‰©å“æŒ‰éˆ•
            document.getElementById('showUnpackedBtn').addEventListener('click', showUnpackedItems);
            
            // å…¨é¸/å–æ¶ˆå…¨é¸æŒ‰éˆ•
            let allChecked = false;
            document.getElementById('checkAllBtn').addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('.checkbox');
                allChecked = !allChecked;
                
                checkboxes.forEach(checkbox => {
                    checkbox.checked = allChecked;
                    const item = checkbox.closest('.item');
                    
                    if (allChecked) {
                        item.classList.add('completed');
                        checkedItems[checkbox.id] = true;
                    } else {
                        item.classList.remove('completed');
                        delete checkedItems[checkbox.id];
                    }
                });
                
                updateProgress();
                saveProgress();
                
                // æ›´æ–°æŒ‰éˆ•æ–‡å­—
                const btnText = allChecked ? 'å–æ¶ˆå…¨é¸' : 'å…¨é¸';
                const btn = document.getElementById('checkAllBtn');
                btn.querySelector('span').textContent = allChecked ? 'å–æ¶ˆ' : 'å…¨é¸';
            });
            
            // é‡ç½®å‹¾é¸æŒ‰éˆ•
            document.getElementById('resetBtn').addEventListener('click', function() {
                if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰å‹¾é¸é …ç›®å—ï¼Ÿï¼ˆä¸æœƒåˆªé™¤æ‚¨æ–°å¢çš„ç‰©å“ï¼‰')) {
                    const checkboxes = document.querySelectorAll('.checkbox');
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = false;
                        const item = checkbox.closest('.item');
                        item.classList.remove('completed');
                    });
                    checkedItems = {};
                    updateProgress();
                    saveProgress();
                    document.getElementById('checkAllBtn').querySelector('span').textContent = 'å…¨é¸';
                }
            });
            
            // æ¢å¾©é è¨­æ¸…å–®æŒ‰éˆ•
            document.getElementById('restoreBtn').addEventListener('click', function() {
                if (confirm('ç¢ºå®šè¦æ¢å¾©é è¨­æ¸…å–®å—ï¼Ÿé€™æœƒåˆªé™¤æ‚¨æ–°å¢çš„æ‰€æœ‰åˆ†é¡å’Œç‰©å“ï¼Œä¸¦æ¢å¾©åˆ°åˆå§‹ç‹€æ…‹ã€‚')) {
                    // æ¢å¾©é è¨­æ¸…å–®
                    packingList = JSON.parse(JSON.stringify(defaultPackingList));
                    
                    // æ¸…é™¤æ‰€æœ‰å‹¾é¸ç‹€æ…‹
                    checkedItems = {};
                    
                    // æ¸…é™¤æœ¬åœ°å„²å­˜ä¸­çš„è‡ªå®šç¾©æ¸…å–®
                    localStorage.removeItem('packcatList');
                    
                    // é‡æ–°æ¸²æŸ“
                    saveProgress();
                    renderChecklist();
                    updateProgress();
                    
                    showNotification('âœ… å·²æ¢å¾©é è¨­æ¸…å–®ï¼');
                }
            });
            
            // ç¶å®šç·¨è¼¯å°è²¼å£«æŒ‰éˆ•
            document.getElementById('editTipBtn').addEventListener('click', function() {
                openTipModal();
            });
            
            // ç¶å®šæ–°å¢åˆ†é¡æŒ‰éˆ•
            document.getElementById('addCategoryBtn').addEventListener('click', function() {
                openAddCategoryModal();
            });
            
            // åˆå§‹åŒ–é é¢æ¨™é¡Œ
            document.title = `PackCat ğŸ± - ${tripInfo.title}`;
            
            // è¨­ç½®æ‹–æ”¾äº‹ä»¶ç›£è½å™¨
            setupDragAndDrop();
        });

        // è¨­ç½®è¡Œç¨‹è³‡è¨Šç·¨è¼¯åŠŸèƒ½
        function setupTripInfoEditing() {
            // ç‚ºæ¯å€‹ç·¨è¼¯åœ–ç¤ºæ·»åŠ é»æ“Šäº‹ä»¶
            document.querySelectorAll('.edit-icon').forEach(icon => {
                icon.addEventListener('click', function() {
                    const field = this.dataset.field;
                    startEditingTripInfo(field);
                });
            });
            
            // ç‚ºè¼¸å…¥æ¡†æ·»åŠ äº‹ä»¶
            document.querySelectorAll('.info-input').forEach(input => {
                input.addEventListener('blur', function() {
                    finishEditingTripInfo();
                });
                
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        finishEditingTripInfo();
                    }
                });
            });
        }

        // è¨­ç½®æ‹–æ”¾åŠŸèƒ½
        function setupDragAndDrop() {
            // è¨­ç½®åˆ†é¡æ‹–æ”¾
            document.addEventListener('dragstart', function(e) {
                if (e.target.classList.contains('category-card')) {
                    draggedCategory = e.target;
                    e.target.classList.add('dragging');
                    isDragging = true;
                } else if (e.target.classList.contains('item') || e.target.closest('.item')) {
                    const item = e.target.classList.contains('item') ? e.target : e.target.closest('.item');
                    draggedItem = item;
                    item.classList.add('dragging');
                    isDragging = true;
                }
            });
            
            document.addEventListener('dragend', function(e) {
                if (draggedCategory) {
                    draggedCategory.classList.remove('dragging');
                    draggedCategory = null;
                }
                if (draggedItem) {
                    draggedItem.classList.remove('dragging');
                    draggedItem = null;
                }
                isDragging = false;
                
                // ç§»é™¤æ‰€æœ‰æ‹–æ”¾æŒ‡ç¤ºå™¨
                document.querySelectorAll('.drop-indicator').forEach(indicator => {
                    indicator.remove();
                });
            });
            
            document.addEventListener('dragover', function(e) {
                e.preventDefault();
                
                if (!isDragging) return;
                
                // è™•ç†åˆ†é¡æ‹–æ”¾
                if (draggedCategory) {
                    const categoryCard = e.target.closest('.category-card');
                    if (categoryCard && categoryCard !== draggedCategory) {
                        dragOverCategory = categoryCard;
                        
                        // é¡¯ç¤ºæ‹–æ”¾ä½ç½®æŒ‡ç¤ºå™¨
                        const rect = categoryCard.getBoundingClientRect();
                        const isBefore = e.clientY < rect.top + rect.height / 2;
                        
                        // ç§»é™¤ç¾æœ‰æŒ‡ç¤ºå™¨
                        document.querySelectorAll('.drop-indicator').forEach(indicator => {
                            indicator.remove();
                        });
                        
                        // å‰µå»ºæ–°æŒ‡ç¤ºå™¨
                        const indicator = document.createElement('div');
                        indicator.className = 'drop-indicator active';
                        indicator.style.position = 'absolute';
                        indicator.style.width = '100%';
                        indicator.style.height = '4px';
                        indicator.style.backgroundColor = 'var(--primary-color)';
                        indicator.style.borderRadius = '2px';
                        
                        if (isBefore) {
                            categoryCard.parentNode.insertBefore(indicator, categoryCard);
                        } else {
                            categoryCard.parentNode.insertBefore(indicator, categoryCard.nextSibling);
                        }
                    }
                }
                
                // è™•ç†ç‰©å“æ‹–æ”¾
                if (draggedItem) {
                    const item = e.target.closest('.item');
                    if (item && item !== draggedItem) {
                        dragOverItem = item;
                        
                        // é¡¯ç¤ºæ‹–æ”¾ä½ç½®æŒ‡ç¤ºå™¨
                        const rect = item.getBoundingClientRect();
                        const isBefore = e.clientY < rect.top + rect.height / 2;
                        
                        // ç§»é™¤ç¾æœ‰æŒ‡ç¤ºå™¨
                        document.querySelectorAll('.drop-indicator').forEach(indicator => {
                            indicator.remove();
                        });
                        
                        // å‰µå»ºæ–°æŒ‡ç¤ºå™¨
                        const indicator = document.createElement('div');
                        indicator.className = 'drop-indicator active';
                        indicator.style.position = 'absolute';
                        indicator.style.width = 'calc(100% - 40px)';
                        indicator.style.height = '4px';
                        indicator.style.backgroundColor = 'var(--primary-color)';
                        indicator.style.borderRadius = '2px';
                        indicator.style.left = '40px';
                        
                        if (isBefore) {
                            item.parentNode.insertBefore(indicator, item);
                        } else {
                            item.parentNode.insertBefore(indicator, item.nextSibling);
                        }
                    }
                }
            });
            
            document.addEventListener('drop', function(e) {
                e.preventDefault();
                
                if (draggedCategory && dragOverCategory) {
                    // ç²å–åˆ†é¡ç´¢å¼•
                    const draggedIndex = Array.from(draggedCategory.parentNode.children).indexOf(draggedCategory);
                    const targetIndex = Array.from(dragOverCategory.parentNode.children).indexOf(dragOverCategory);
                    
                    // è¨ˆç®—æ’å…¥ä½ç½®
                    const rect = dragOverCategory.getBoundingClientRect();
                    const isBefore = e.clientY < rect.top + rect.height / 2;
                    
                    // å¾æ•¸çµ„ä¸­ç§»å‹•åˆ†é¡
                    const draggedCatIndex = parseInt(draggedCategory.dataset.categoryIndex);
                    const targetCatIndex = parseInt(dragOverCategory.dataset.categoryIndex);
                    
                    // é‡æ–°æ’åºæ•¸çµ„
                    const [movedCategory] = packingList.splice(draggedCatIndex, 1);
                    
                    // èª¿æ•´æ’å…¥ä½ç½®
                    let insertIndex = targetCatIndex;
                    if (draggedCatIndex < targetCatIndex && isBefore) {
                        insertIndex = targetCatIndex - 1;
                    } else if (draggedCatIndex > targetCatIndex && !isBefore) {
                        insertIndex = targetCatIndex + 1;
                    }
                    
                    packingList.splice(insertIndex, 0, movedCategory);
                    
                    // é‡æ–°æ¸²æŸ“æ¸…å–®
                    saveProgress();
                    renderChecklist();
                    updateProgress();
                    
                    showNotification('âœ… åˆ†é¡é †åºå·²èª¿æ•´ï¼');
                }
                
                if (draggedItem && dragOverItem) {
                    // ç²å–ç‰©å“æ‰€åœ¨çš„é¡åˆ¥
                    const draggedCategoryCard = draggedItem.closest('.category-card');
                    const targetCategoryCard = dragOverItem.closest('.category-card');
                    
                    const draggedCatIndex = parseInt(draggedCategoryCard.dataset.categoryIndex);
                    const targetCatIndex = parseInt(targetCategoryCard.dataset.categoryIndex);
                    
                    // ç²å–ç‰©å“åœ¨å„è‡ªé¡åˆ¥ä¸­çš„ç´¢å¼•
                    const draggedItemIndex = Array.from(draggedItem.parentNode.children).indexOf(draggedItem);
                    const targetItemIndex = Array.from(dragOverItem.parentNode.children).indexOf(dragOverItem);
                    
                    // è¨ˆç®—æ’å…¥ä½ç½®
                    const rect = dragOverItem.getBoundingClientRect();
                    const isBefore = e.clientY < rect.top + rect.height / 2;
                    
                    // å¾æ•¸çµ„ä¸­ç§»å‹•ç‰©å“
                    const [movedItem] = packingList[draggedCatIndex].items.splice(draggedItemIndex, 1);
                    
                    // å¦‚æœæ˜¯åŒä¸€å€‹åˆ†é¡
                    if (draggedCatIndex === targetCatIndex) {
                        // èª¿æ•´æ’å…¥ä½ç½®
                        let insertIndex = targetItemIndex;
                        if (draggedItemIndex < targetItemIndex && isBefore) {
                            insertIndex = targetItemIndex - 1;
                        } else if (draggedItemIndex > targetItemIndex && !isBefore) {
                            insertIndex = targetItemIndex + 1;
                        }
                        
                        packingList[targetCatIndex].items.splice(insertIndex, 0, movedItem);
                    } else {
                        // ä¸åŒåˆ†é¡ï¼Œç›´æ¥æ’å…¥
                        let insertIndex = targetItemIndex;
                        if (!isBefore) insertIndex = targetItemIndex + 1;
                        
                        packingList[targetCatIndex].items.splice(insertIndex, 0, movedItem);
                    }
                    
                    // é‡æ–°æ¸²æŸ“æ¸…å–®
                    saveProgress();
                    renderChecklist();
                    updateProgress();
                    
                    showNotification('âœ… ç‰©å“é †åºå·²èª¿æ•´ï¼');
                }
                
                // é‡ç½®æ‹–æ”¾è®Šæ•¸
                draggedCategory = null;
                dragOverCategory = null;
                draggedItem = null;
                dragOverItem = null;
                
                // ç§»é™¤æ‰€æœ‰æ‹–æ”¾æŒ‡ç¤ºå™¨
                document.querySelectorAll('.drop-indicator').forEach(indicator => {
                    indicator.remove();
                });
            });
            
            // ç‚ºè§¸æ§è¨­å‚™æ·»åŠ æ”¯æŒ
            document.addEventListener('touchstart', function(e) {
                const categoryCard = e.target.closest('.category-card');
                const item = e.target.closest('.item');
                
                if (categoryCard) {
                    draggedCategory = categoryCard;
                    categoryCard.classList.add('dragging');
                    isDragging = true;
                } else if (item) {
                    draggedItem = item;
                    item.classList.add('dragging');
                    isDragging = true;
                }
            }, { passive: true });
            
            document.addEventListener('touchend', function(e) {
                if (draggedCategory) {
                    draggedCategory.classList.remove('dragging');
                    draggedCategory = null;
                }
                if (draggedItem) {
                    draggedItem.classList.remove('dragging');
                    draggedItem = null;
                }
                isDragging = false;
                
                // ç§»é™¤æ‰€æœ‰æ‹–æ”¾æŒ‡ç¤ºå™¨
                document.querySelectorAll('.drop-indicator').forEach(indicator => {
                    indicator.remove();
                });
            });
            
            // ç‚ºè§¸æ§è¨­å‚™æ¨¡æ“¬ dragover
            document.addEventListener('touchmove', function(e) {
                if (!isDragging) return;
                
                e.preventDefault();
                const touch = e.touches[0];
                
                // æ¨¡æ“¬ dragover äº‹ä»¶
                const fakeEvent = new MouseEvent('dragover', {
                    clientX: touch.clientX,
                    clientY: touch.clientY,
                    bubbles: true,
                    cancelable: true
                });
                
                // æ‰¾åˆ°è§¸æ‘¸é»ä¸‹çš„å…ƒç´ 
                const element = document.elementFromPoint(touch.clientX, touch.clientY);
                if (element) {
                    element.dispatchEvent(fakeEvent);
                }
            }, { passive: false });
        }

        // é–‹å§‹ç·¨è¼¯è¡Œç¨‹è³‡è¨Š
        function startEditingTripInfo(field) {
            // å¦‚æœå·²ç¶“åœ¨ç·¨è¼¯å…¶ä»–å­—æ®µï¼Œå…ˆå®Œæˆç·¨è¼¯
            if (currentEditingField) {
                finishEditingTripInfo();
            }
            
            currentEditingField = field;
            const card = document.getElementById(`${field}Card`);
            const valueElement = document.getElementById(`${field}Value`);
            const inputElement = document.getElementById(`${field}Input`);
            
            // æ·»åŠ ç·¨è¼¯æ¨£å¼
            card.classList.add('editing');
            
            // é¡¯ç¤ºè¼¸å…¥æ¡†ï¼Œéš±è—æ–‡æœ¬
            valueElement.style.display = 'none';
            inputElement.style.display = 'block';
            inputElement.focus();
            
            // æ ¹æ“šå­—æ®µé¡å‹è¨­ç½®è¼¸å…¥æ¡†å€¼
            if (field === 'days') {
                inputElement.value = tripInfo.days;
            } else {
                inputElement.value = tripInfo[field];
            }
            
            // é¸ä¸­æ‰€æœ‰æ–‡æœ¬
            inputElement.select();
        }

        // å®Œæˆç·¨è¼¯è¡Œç¨‹è³‡è¨Š
        function finishEditingTripInfo() {
            if (!currentEditingField) return;
            
            const field = currentEditingField;
            const card = document.getElementById(`${field}Card`);
            const valueElement = document.getElementById(`${field}Value`);
            const inputElement = document.getElementById(`${field}Input`);
            
            // ç§»é™¤ç·¨è¼¯æ¨£å¼
            card.classList.remove('editing');
            
            // éš±è—è¼¸å…¥æ¡†ï¼Œé¡¯ç¤ºæ–‡æœ¬
            inputElement.style.display = 'none';
            valueElement.style.display = 'block';
            
            // ç²å–æ–°å€¼
            let newValue = inputElement.value.trim();
            
            // é©—è­‰ä¸¦æ›´æ–°å€¼
            if (field === 'days') {
                const days = parseInt(newValue);
                if (days >= 1 && days <= 30) {
                    tripInfo.days = days;
                    valueElement.textContent = `${days}å¤©`;
                    
                    // æ›´æ–°æ¸…å–®ä¸­çš„å‹•æ…‹è¨ˆç®—æ•¸é‡
                    renderChecklist();
                    updateProgress();
                } else {
                    showNotification('è«‹è¼¸å…¥1-30ä¹‹é–“çš„æ•¸å­—');
                    inputElement.value = tripInfo.days;
                }
            } else {
                if (newValue) {
                    tripInfo[field] = newValue;
                    valueElement.textContent = newValue;
                    
                    // å¦‚æœä¿®æ”¹äº†æœˆä»½ï¼Œæ›´æ–°å°è²¼å£«
                    if (field === 'month') {
                        updateTipForMonth(newValue);
                    }
                }
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å„²å­˜
            localStorage.setItem('packcatTripInfo', JSON.stringify(tripInfo));
            
            // é‡ç½®ç•¶å‰ç·¨è¼¯å­—æ®µ
            currentEditingField = null;
        }

        // æ ¹æ“šæœˆä»½æ›´æ–°å°è²¼å£«
        function updateTipForMonth(month) {
            const monthText = month.toLowerCase();
            let season = "å†¬å­£";
            
            if (monthText.includes('æ˜¥') || monthText.includes('3') || monthText.includes('4') || monthText.includes('5')) {
                season = "æ˜¥å­£";
            } else if (monthText.includes('å¤') || monthText.includes('6') || monthText.includes('7') || monthText.includes('8')) {
                season = "å¤å­£";
            } else if (monthText.includes('ç§‹') || monthText.includes('9') || monthText.includes('10') || monthText.includes('11')) {
                season = "ç§‹å­£";
            }
            
            // æ›´æ–°å°è²¼å£«ä¸­çš„å­£ç¯€ä¿¡æ¯
            const newTip = tipContent.replace(/å†¬å­£|æ˜¥å­£|å¤å­£|ç§‹å­£/g, season);
            if (newTip !== tipContent) {
                tipContent = newTip;
                tipContentElement.textContent = tipContent;
                localStorage.setItem('packcatTip', tipContent);
            }
        }

        // æ›´æ–°è¡Œç¨‹è³‡è¨Šé¡¯ç¤º
        function updateTripInfoDisplay() {
            document.getElementById('destinationValue').textContent = tripInfo.destination;
            document.getElementById('destinationInput').value = tripInfo.destination;
            
            document.getElementById('monthValue').textContent = tripInfo.month;
            document.getElementById('monthInput').value = tripInfo.month;
            
            document.getElementById('daysValue').textContent = `${tripInfo.days}å¤©`;
            document.getElementById('daysInput').value = tripInfo.days;
            
            document.getElementById('peopleValue').textContent = tripInfo.people;
            document.getElementById('peopleInput').value = tripInfo.people;
        }

        // æ¸²æŸ“åœ–ç¤ºé¸æ“‡å™¨
        function renderIconSelector() {
            iconSelector.innerHTML = '';
            availableIcons.forEach(icon => {
                const iconOption = document.createElement('div');
                iconOption.className = 'icon-option';
                iconOption.innerHTML = `<i class="${icon}"></i>`;
                iconOption.dataset.icon = icon;
                
                iconOption.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰é¸ä¸­ç‹€æ…‹
                    document.querySelectorAll('.icon-option').forEach(option => {
                        option.classList.remove('selected');
                    });
                    
                    // æ·»åŠ é¸ä¸­ç‹€æ…‹
                    this.classList.add('selected');
                    selectedIconInput.value = icon;
                });
                
                iconSelector.appendChild(iconOption);
            });
            
            // é è¨­é¸ä¸­ç¬¬ä¸€å€‹åœ–ç¤º
            if (iconSelector.firstChild) {
                iconSelector.firstChild.classList.add('selected');
                selectedIconInput.value = availableIcons[0];
            }
        }

        // æ¸²æŸ“æ¸…å–®
        function renderChecklist() {
            const checklistContainer = document.getElementById('checklist');
            checklistContainer.innerHTML = '';
            
            packingList.forEach((category, categoryIndex) => {
                const categoryCard = document.createElement('div');
                categoryCard.className = 'category-card';
                categoryCard.dataset.categoryIndex = categoryIndex;
                categoryCard.draggable = true;
                
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                
                const categoryIcon = document.createElement('div');
                categoryIcon.className = 'category-icon';
                categoryIcon.innerHTML = `<i class="${category.icon}"></i>`;
                
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'category-title';
                categoryTitle.textContent = category.category;
                
                const categoryActions = document.createElement('div');
                categoryActions.className = 'category-actions';
                
                const addItemBtn = document.createElement('button');
                addItemBtn.className = 'category-btn add-item-btn';
                addItemBtn.innerHTML = '<i class="fas fa-plus"></i>';
                addItemBtn.title = 'æ–°å¢ç‰©å“';
                addItemBtn.addEventListener('click', () => openAddItemModal(categoryIndex));
                
                const editCategoryBtn = document.createElement('button');
                editCategoryBtn.className = 'category-btn edit-category-btn';
                editCategoryBtn.innerHTML = '<i class="fas fa-edit"></i>';
                editCategoryBtn.title = 'ç·¨è¼¯åˆ†é¡';
                editCategoryBtn.addEventListener('click', () => openEditCategoryModal(categoryIndex));
                
                const deleteCategoryBtn = document.createElement('button');
                deleteCategoryBtn.className = 'category-btn delete-category-btn';
                deleteCategoryBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteCategoryBtn.title = 'åˆªé™¤åˆ†é¡';
                deleteCategoryBtn.addEventListener('click', () => deleteCategory(categoryIndex));
                
                categoryActions.appendChild(addItemBtn);
                categoryActions.appendChild(editCategoryBtn);
                categoryActions.appendChild(deleteCategoryBtn);
                
                categoryHeader.appendChild(categoryIcon);
                categoryHeader.appendChild(categoryTitle);
                categoryHeader.appendChild(categoryActions);
                
                const itemsList = document.createElement('ul');
                itemsList.className = 'items-list';
                
                category.items.forEach((item, itemIndex) => {
                    const listItem = document.createElement('li');
                    listItem.className = 'item';
                    listItem.draggable = true;
                    
                    const itemId = item.id.toString();
                    const isChecked = checkedItems[itemId] || false;
                    
                    if (isChecked) {
                        listItem.classList.add('completed');
                    }
                    
                    // æ‹–å‹•æ‰‹æŸ„
                    const dragHandle = document.createElement('div');
                    dragHandle.className = 'drag-handle';
                    dragHandle.innerHTML = '<i class="fas fa-grip-vertical"></i>';
                    dragHandle.title = 'æ‹–å‹•èª¿æ•´é †åº';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'checkbox';
                    checkbox.id = itemId;
                    checkbox.checked = isChecked;
                    
                    const itemContent = document.createElement('div');
                    itemContent.className = 'item-content';
                    
                    const label = document.createElement('span');
                    label.className = 'item-label';
                    label.textContent = item.name;
                    
                    // è¨ˆç®—æ•¸é‡ï¼ˆå¦‚æœæ˜¯å‹•æ…‹è¨ˆç®—çš„è¡£ç‰©é¡ï¼‰
                    let quantity = item.quantity;
                    if (quantity === "å‹•æ…‹è¨ˆç®—" && item.baseFormula && category.category.includes("è¡£ç‰©")) {
                        quantity = calculateClothingQuantity(item.baseFormula, tripInfo.days);
                    }
                    
                    const quantitySpan = document.createElement('span');
                    quantitySpan.className = 'item-quantity';
                    quantitySpan.textContent = `æ•¸é‡ï¼š${quantity}`;
                    
                    itemContent.appendChild(label);
                    itemContent.appendChild(quantitySpan);
                    
                    if (item.note && item.note.trim() !== '') {
                        const note = document.createElement('span');
                        note.className = 'item-note';
                        note.textContent = item.note;
                        itemContent.appendChild(note);
                    }
                    
                    const itemActions = document.createElement('div');
                    itemActions.className = 'item-actions';
                    
                    const editBtn = document.createElement('button');
                    editBtn.className = 'item-btn edit-btn';
                    editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                    editBtn.title = 'ç·¨è¼¯';
                    editBtn.addEventListener('click', () => openEditItemModal(categoryIndex, itemIndex, item));
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'item-btn delete-btn';
                    deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                    deleteBtn.title = 'åˆªé™¤';
                    deleteBtn.addEventListener('click', () => deleteItem(categoryIndex, itemIndex));
                    
                    itemActions.appendChild(editBtn);
                    itemActions.appendChild(deleteBtn);
                    
                    listItem.appendChild(dragHandle);
                    listItem.appendChild(checkbox);
                    listItem.appendChild(itemContent);
                    listItem.appendChild(itemActions);
                    
                    itemsList.appendChild(listItem);
                    
                    // æ·»åŠ å‹¾é¸äº‹ä»¶ç›£è½å™¨
                    checkbox.addEventListener('change', function() {
                        const isChecked = this.checked;
                        const itemElement = this.closest('.item');
                        
                        if (isChecked) {
                            itemElement.classList.add('completed');
                            checkedItems[this.id] = true;
                        } else {
                            itemElement.classList.remove('completed');
                            delete checkedItems[this.id];
                        }
                        
                        updateProgress();
                        saveProgress();
                    });
                });
                
                categoryCard.appendChild(categoryHeader);
                categoryCard.appendChild(itemsList);
                checklistContainer.appendChild(categoryCard);
            });
        }

        // æ›´æ–°é€²åº¦
        function updateProgress() {
            const progressPercent = document.getElementById('progressPercent');
            const progressFill = document.getElementById('progressFill');
            const packedCount = document.getElementById('packedCount');
            const totalCount = document.getElementById('totalCount');
            
            const checkedCount = Object.keys(checkedItems).length;
            const totalItems = calculateTotalItems();
            const percentage = totalItems > 0 ? Math.round((checkedCount / totalItems) * 100) : 0;
            
            progressPercent.textContent = `${percentage}%`;
            progressFill.style.width = `${percentage}%`;
            packedCount.textContent = checkedCount;
            totalCount.textContent = totalItems;
        }

        // å„²å­˜é€²åº¦åˆ°æœ¬åœ°å„²å­˜
        function saveProgress() {
            localStorage.setItem('packcatCheckedItems', JSON.stringify(checkedItems));
            localStorage.setItem('packcatList', JSON.stringify(packingList));
            localStorage.setItem('packcatTip', tipContent);
            localStorage.setItem('packcatTripInfo', JSON.stringify(tripInfo));
        }

        // é¡¯ç¤ºæœªæº–å‚™ç‰©å“
        function showUnpackedItems() {
            // æ”¶é›†æœªå‹¾é¸çš„ç‰©å“
            const unpackedItems = [];
            
            packingList.forEach(category => {
                const categoryUnpacked = {
                    category: category.category,
                    icon: category.icon,
                    items: []
                };
                
                category.items.forEach(item => {
                    const itemId = item.id.toString();
                    if (!checkedItems[itemId]) {
                        // è¨ˆç®—æ•¸é‡ï¼ˆå¦‚æœæ˜¯å‹•æ…‹è¨ˆç®—çš„è¡£ç‰©é¡ï¼‰
                        let quantity = item.quantity;
                        if (quantity === "å‹•æ…‹è¨ˆç®—" && item.baseFormula && category.category.includes("è¡£ç‰©")) {
                            quantity = calculateClothingQuantity(item.baseFormula, tripInfo.days);
                        }
                        
                        categoryUnpacked.items.push({
                            name: item.name,
                            quantity: quantity,
                            note: item.note
                        });
                    }
                });
                
                if (categoryUnpacked.items.length > 0) {
                    unpackedItems.push(categoryUnpacked);
                }
            });
            
            // æ¸²æŸ“æœªæº–å‚™ç‰©å“
            renderUnpackedItems(unpackedItems);
            
            // é¡¯ç¤ºå½ˆå‡ºè¦–çª—
            unpackedModal.style.display = 'flex';
        }

        // æ¸²æŸ“æœªæº–å‚™ç‰©å“
        function renderUnpackedItems(unpackedItems) {
            unpackedItemsContainer.innerHTML = '';
            
            if (unpackedItems.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <h3>å¤ªæ£’äº†ï¼ğŸ‰</h3>
                    <p>æ‚¨å·²ç¶“æº–å‚™å¥½æ‰€æœ‰ç‰©å“äº†ï¼</p>
                    <p>å¯ä»¥å®‰å¿ƒå‡ºç™¼å»æ—…è¡Œäº†ï½</p>
                `;
                unpackedItemsContainer.appendChild(emptyState);
                return;
            }
            
            unpackedItems.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'unpacked-category';
                
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'unpacked-category-title';
                categoryTitle.innerHTML = `<i class="${category.icon}"></i> ${category.category}`;
                
                categoryDiv.appendChild(categoryTitle);
                
                category.items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'unpacked-item';
                    
                    const itemInfo = document.createElement('div');
                    itemInfo.innerHTML = `
                        <div style="font-weight: 600; margin-bottom: 5px;">${item.name}</div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="background-color: #ffecf0; padding: 2px 8px; border-radius: 10px; font-size: 0.9rem;">æ•¸é‡ï¼š${item.quantity}</span>
                            ${item.note ? `<span style="font-size: 0.9rem; color: #888; font-style: italic;">${item.note}</span>` : ''}
                        </div>
                    `;
                    
                    itemDiv.appendChild(itemInfo);
                    categoryDiv.appendChild(itemDiv);
                });
                
                unpackedItemsContainer.appendChild(categoryDiv);
            });
        }

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message) {
            // æª¢æŸ¥æ˜¯å¦å·²ç¶“æœ‰é€šçŸ¥å…ƒç´ 
            let notification = document.getElementById('packcatNotification');
            
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'packcatNotification';
                notification.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%) translateY(100px);
                    background-color: var(--primary-color);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 10px;
                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                    z-index: 3000;
                    font-weight: 600;
                    transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                    max-width: 300px;
                    width: 90%;
                    text-align: center;
                    border-left: 5px solid var(--secondary-color);
                    font-size: 0.95rem;
                `;
                document.body.appendChild(notification);
            }
            
            notification.textContent = message;
            notification.style.transform = 'translateX(-50%) translateY(0)';
            
            // 3ç§’å¾Œè‡ªå‹•æ¶ˆå¤±
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(100px)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 500);
            }, 3000);
        }

        // æ‰“é–‹æ–°å¢ç‰©å“å½ˆå‡ºè¦–çª—
        function openAddItemModal(categoryIndex) {
            currentEditItem = {
                categoryIndex: categoryIndex,
                itemIndex: -1,
                itemId: Date.now(),
                isEdit: false
            };
            
            document.getElementById('modalTitle').textContent = 'æ–°å¢ç‰©å“';
            itemNameInput.value = '';
            itemQuantityInput.value = '';
            itemNoteInput.value = '';
            itemModal.style.display = 'flex';
            setTimeout(() => itemNameInput.focus(), 100);
        }

        // æ‰“é–‹ç·¨è¼¯ç‰©å“å½ˆå‡ºè¦–çª—
        function openEditItemModal(categoryIndex, itemIndex, item) {
            currentEditItem = {
                categoryIndex: categoryIndex,
                itemIndex: itemIndex,
                itemId: item.id,
                isEdit: true
            };
            
            document.getElementById('modalTitle').textContent = 'ç·¨è¼¯ç‰©å“';
            itemNameInput.value = item.name;
            itemQuantityInput.value = item.quantity;
            itemNoteInput.value = item.note || '';
            itemModal.style.display = 'flex';
            setTimeout(() => itemNameInput.focus(), 100);
        }

        // é—œé–‰ç‰©å“å½ˆå‡ºè¦–çª—
        function closeItemModal() {
            itemModal.style.display = 'none';
            currentEditItem = {
                categoryIndex: -1,
                itemIndex: -1,
                itemId: null,
                isEdit: false
            };
        }

        // å„²å­˜ç‰©å“ï¼ˆæ–°å¢æˆ–ç·¨è¼¯ï¼‰
        function saveItem() {
            const name = itemNameInput.value.trim();
            const quantity = itemQuantityInput.value.trim();
            const note = itemNoteInput.value.trim();
            
            if (!name) {
                showNotification('è«‹è¼¸å…¥ç‰©å“åç¨±');
                itemNameInput.focus();
                return;
            }
            
            if (!quantity) {
                showNotification('è«‹è¼¸å…¥å»ºè­°æ•¸é‡');
                itemQuantityInput.focus();
                return;
            }
            
            if (currentEditItem.isEdit) {
                // ç·¨è¼¯ç¾æœ‰é …ç›®
                packingList[currentEditItem.categoryIndex].items[currentEditItem.itemIndex] = {
                    id: currentEditItem.itemId,
                    name: name,
                    quantity: quantity,
                    note: note
                };
            } else {
                // æ–°å¢é …ç›®
                packingList[currentEditItem.categoryIndex].items.push({
                    id: currentEditItem.itemId,
                    name: name,
                    quantity: quantity,
                    note: note
                });
            }
            
            // å„²å­˜ä¸¦é‡æ–°æ¸²æŸ“
            saveProgress();
            renderChecklist();
            updateProgress();
            closeItemModal();
            
            showNotification('âœ… ç‰©å“å·²å„²å­˜ï¼');
        }

        // åˆªé™¤ç‰©å“
        function deleteItem(categoryIndex, itemIndex) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ç‰©å“å—ï¼Ÿ')) {
                return;
            }
            
            const item = packingList[categoryIndex].items[itemIndex];
            
            // å¾å‹¾é¸ç‹€æ…‹ä¸­ç§»é™¤
            delete checkedItems[item.id];
            
            // å¾æ¸…å–®ä¸­ç§»é™¤
            packingList[categoryIndex].items.splice(itemIndex, 1);
            
            // å„²å­˜ä¸¦é‡æ–°æ¸²æŸ“
            saveProgress();
            renderChecklist();
            updateProgress();
            
            showNotification('ğŸ—‘ï¸ ç‰©å“å·²åˆªé™¤ï¼');
        }

        // æ‰“é–‹æ–°å¢åˆ†é¡å½ˆå‡ºè¦–çª—
        function openAddCategoryModal() {
            currentEditCategory = {
                categoryIndex: -1,
                isEdit: false
            };
            
            document.getElementById('categoryModalTitle').textContent = 'æ–°å¢åˆ†é¡';
            categoryNameInput.value = '';
            selectedIconInput.value = 'fas fa-star';
            
            // é‡ç½®åœ–ç¤ºé¸æ“‡å™¨
            document.querySelectorAll('.icon-option').forEach((option, index) => {
                option.classList.remove('selected');
                if (index === 0) option.classList.add('selected');
            });
            
            categoryModal.style.display = 'flex';
            setTimeout(() => categoryNameInput.focus(), 100);
        }

        // æ‰“é–‹ç·¨è¼¯åˆ†é¡å½ˆå‡ºè¦–çª—
        function openEditCategoryModal(categoryIndex) {
            const category = packingList[categoryIndex];
            currentEditCategory = {
                categoryIndex: categoryIndex,
                isEdit: true
            };
            
            document.getElementById('categoryModalTitle').textContent = 'ç·¨è¼¯åˆ†é¡';
            categoryNameInput.value = category.category.replace(/[ğŸ“„ğŸ“±ğŸ‘šğŸ§£ğŸ§´ğŸ’ŠğŸ’]/g, '').trim();
            selectedIconInput.value = category.icon;
            
            // è¨­ç½®åœ–ç¤ºé¸æ“‡å™¨
            document.querySelectorAll('.icon-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.icon === category.icon) {
                    option.classList.add('selected');
                }
            });
            
            categoryModal.style.display = 'flex';
            setTimeout(() => categoryNameInput.focus(), 100);
        }

        // é—œé–‰åˆ†é¡å½ˆå‡ºè¦–çª—
        function closeCategoryModal() {
            categoryModal.style.display = 'none';
            currentEditCategory = {
                categoryIndex: -1,
                isEdit: false
            };
        }

        // å„²å­˜åˆ†é¡ï¼ˆæ–°å¢æˆ–ç·¨è¼¯ï¼‰
        function saveCategory() {
            const name = categoryNameInput.value.trim();
            const icon = selectedIconInput.value;
            
            if (!name) {
                showNotification('è«‹è¼¸å…¥åˆ†é¡åç¨±');
                categoryNameInput.focus();
                return;
            }
            
            if (currentEditCategory.isEdit) {
                // ç·¨è¼¯ç¾æœ‰åˆ†é¡
                packingList[currentEditCategory.categoryIndex].category = name;
                packingList[currentEditCategory.categoryIndex].icon = icon;
            } else {
                // æ–°å¢åˆ†é¡
                const newCategory = {
                    id: Date.now(),
                    category: name,
                    icon: icon,
                    items: []
                };
                packingList.push(newCategory);
            }
            
            // å„²å­˜ä¸¦é‡æ–°æ¸²æŸ“
            saveProgress();
            renderChecklist();
            updateProgress();
            closeCategoryModal();
            
            showNotification('âœ… åˆ†é¡å·²å„²å­˜ï¼');
        }

        // åˆªé™¤åˆ†é¡
        function deleteCategory(categoryIndex) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹åˆ†é¡å—ï¼Ÿåˆ†é¡å…§çš„æ‰€æœ‰ç‰©å“ä¹Ÿæœƒä¸€ä½µåˆªé™¤ã€‚')) {
                return;
            }
            
            // å¾å‹¾é¸ç‹€æ…‹ä¸­ç§»é™¤è©²åˆ†é¡ä¸‹æ‰€æœ‰ç‰©å“
            packingList[categoryIndex].items.forEach(item => {
                delete checkedItems[item.id];
            });
            
            // å¾æ¸…å–®ä¸­ç§»é™¤åˆ†é¡
            packingList.splice(categoryIndex, 1);
            
            // å„²å­˜ä¸¦é‡æ–°æ¸²æŸ“
            saveProgress();
            renderChecklist();
            updateProgress();
            
            showNotification('ğŸ—‘ï¸ åˆ†é¡å·²åˆªé™¤ï¼');
        }

        // æ‰“é–‹å°è²¼å£«ç·¨è¼¯å½ˆå‡ºè¦–çª—
        function openTipModal() {
            tipTextInput.value = tipContent;
            tipModal.style.display = 'flex';
            setTimeout(() => tipTextInput.focus(), 100);
        }

        // é—œé–‰å°è²¼å£«å½ˆå‡ºè¦–çª—
        function closeTipModal() {
            tipModal.style.display = 'none';
        }

        // å„²å­˜å°è²¼å£«
        function saveTip() {
            tipContent = tipTextInput.value.trim();
            tipContentElement.textContent = tipContent;
            
            // å„²å­˜åˆ°æœ¬åœ°å„²å­˜
            localStorage.setItem('packcatTip', tipContent);
            
            closeTipModal();
            showNotification('ğŸ’¡ å°è²¼å£«å·²æ›´æ–°ï¼');
        }
    </script>
</body>
</html>